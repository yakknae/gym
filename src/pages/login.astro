---
// src/pages/login.astro
const token = Astro.cookies.get("auth-token");
if (token) {
  return Astro.redirect("/");
}
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | Atenas Gym</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>

  <body class="bg-[#0f0f0f] font-['Inter',_sans-serif] min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-[420px]">
      <div class="text-center mb-12">
        <div class="flex items-center justify-center gap-4 mb-4">
          <div
            class="w-[60px] h-[60px] bg-gradient-to-br from-[#ff6b35] to-[#ff8555] rounded-2xl flex items-center justify-center text-[32px] font-extrabold text-white shadow-[0_8px_24px_rgba(255,107,53,0.3)]"
          >
            A
          </div>
          <div class="text-left">
            <h1 class="text-2xl font-extrabold text-white tracking-wider leading-none">ATENAS GYM</h1>
            <p class="text-[12px] text-zinc-500 uppercase tracking-[2px] mt-1">Sistema de Gestión</p>
          </div>
        </div>
      </div>

      <div class="bg-[#1a1a1a] border border-white/5 rounded-[24px] p-8 md:p-10 shadow-[0_20px_60px_rgba(0,0,0,0.5)]">
        <h2 class="text-[28px] font-bold text-white mb-2">Iniciar Sesión</h2>
        <p class="text-zinc-500 text-sm mb-8">Ingresá tus credenciales para continuar</p>

        <div
          id="error-message"
          class="hidden bg-red-500/10 border border-red-500/30 text-red-500 px-4 py-3 rounded-xl text-sm mb-6"
        >
        </div>

        <form id="login-form" class="space-y-6">
          <div class="space-y-2">
            <label for="username" class="block text-zinc-400 text-sm font-medium">Usuario</label>
            <input
              type="text"
              id="username"
              name="username"
              required
              placeholder="Ingresá tu usuario"
              class="w-full bg-[#0f0f0f] border border-white/10 rounded-xl px-4 py-3.5 text-white text-[15px] placeholder:text-zinc-700 focus:outline-none focus:border-[#ff6b35] focus:ring-4 focus:ring-[#ff6b35]/10 transition-all"
            />
          </div>

          <div class="space-y-2">
            <label for="password" class="block text-zinc-400 text-sm font-medium">Contraseña</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              placeholder="Ingresá tu contraseña"
              class="w-full bg-[#0f0f0f] border border-white/10 rounded-xl px-4 py-3.5 text-white text-[15px] placeholder:text-zinc-700 focus:outline-none focus:border-[#ff6b35] focus:ring-4 focus:ring-[#ff6b35]/10 transition-all"
            />
          </div>

          <button
            type="submit"
            class="w-full bg-gradient-to-br from-[#ff6b35] to-[#ff8555] rounded-xl p-4 text-white font-semibold text-base transition-all shadow-[0_4px_16px_rgba(255,107,53,0.3)] hover:shadow-[0_8px_24px_rgba(255,107,53,0.4)] hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-60 disabled:cursor-not-allowed"
          >
            <span id="btn-text">Ingresar</span>
            <span id="btn-loading" class="hidden">Verificando...</span>
          </button>
        </form>
      </div>

      <div class="text-center mt-8">
        <p class="text-zinc-600 text-[13px]">© 2026 Atenas Gym. Sistema de gestión interno.</p>
      </div>
    </div>

    <script>
      const form = document.getElementById("login-form") as HTMLFormElement;
      const errorMessage = document.getElementById("error-message") as HTMLDivElement;
      const btnText = document.getElementById("btn-text") as HTMLSpanElement;
      const btnLoading = document.getElementById("btn-loading") as HTMLSpanElement;
      const submitBtn = form.querySelector("button[type='submit']") as HTMLButtonElement;

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        submitBtn.disabled = true;
        btnText.classList.add("hidden");
        btnLoading.classList.remove("hidden");
        errorMessage.classList.add("hidden");

        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        try {
          const res = await fetch("/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          if (res.ok) {
            window.location.href = "/";
          } else {
            const err = await res.json();
            errorMessage.textContent = err.error || "Credenciales incorrectas";
            errorMessage.classList.remove("hidden");
            resetBtn();
          }
        } catch (error) {
          errorMessage.textContent = "Error de conexión. Intentá de nuevo.";
          errorMessage.classList.remove("hidden");
          resetBtn();
        }
      });

      function resetBtn() {
        submitBtn.disabled = false;
        btnText.classList.remove("hidden");
        btnLoading.classList.add("hidden");
      }
    </script>
  </body>
</html>
