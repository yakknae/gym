---
import Layout from "../../../src/layouts/Layout.astro";
import { socioService } from "../../../src/services/socioService";

const socios = await socioService.getAll();
---

<Layout title="Listado de Socios">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-3xl font-bold text-white">Socios</h1>
      <p class="text-gray-400">Gestion√° los miembros de Atenas Gym</p>
    </div>

    <a
      href="/socios/nuevo"
      class="bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-3 px-6 rounded-lg transition-all shadow-lg shadow-orange-500/50 flex items-center gap-2"
    >
      <span class="text-xl">+</span> Nuevo Socio
    </a>
  </div>

  <div class="bg-[#1a1a1a] rounded-xl shadow-xl border border-orange-500/30 overflow-hidden">
    <table class="w-full text-left border-collapse">
      <thead class="bg-[#0f0f0f] border-b border-orange-500/30">
        <tr>
          <th class="px-6 py-4 text-sm font-semibold text-orange-500">Socio</th>
          <th class="px-6 py-4 text-sm font-semibold text-orange-500">DNI</th>
          <th class="px-6 py-4 text-sm font-semibold text-orange-500">Plan</th>
          <th class="px-6 py-4 text-sm font-semibold text-orange-500">Estado</th>
          <th class="px-6 py-4 text-sm font-semibold text-orange-500 text-right">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-orange-500/10">
        {
          socios.map((socio) => (
            <tr class="hover:bg-orange-500/5 transition-colors">
              <td class="px-6 py-4">
                <div class="font-medium text-white">
                  {socio.nombre} {socio.apellido}
                </div>
                <div class="text-xs text-gray-500">{socio.email || "Sin email"}</div>
              </td>
              <td class="px-6 py-4 text-sm text-gray-300">{socio.dni}</td>
              <td class="px-6 py-4">
                <span class="text-xs font-medium px-3 py-1 rounded-full bg-orange-500/20 text-orange-400 border border-orange-500/30">
                  {socio.planes?.nombre_plan || "Sin Plan"}
                </span>
              </td>
              <td class="px-6 py-4">
                <span
                  class={`text-xs font-medium px-3 py-1 rounded-full ${
                    socio.estado === "Activo"
                      ? "bg-green-500/20 text-green-400 border border-green-500/30"
                      : "bg-red-500/20 text-red-400 border border-red-500/30"
                  }`}
                >
                  {socio.estado}
                </span>
              </td>
              <td class="px-6 py-4 text-right">
                <div class="flex justify-end gap-2">
                  <a
                    href={`/socios/${socio.id_socio}`}
                    class="p-2 hover:bg-orange-500/20 rounded-md transition-colors border border-transparent hover:border-orange-500/50"
                    title="Ver ficha"
                  >
                    üëÅÔ∏è
                  </a>
                  <button
                    class="p-2 hover:bg-red-500/20 text-red-400 rounded-md transition-colors border border-transparent hover:border-red-500/50 btn-eliminar"
                    data-id={socio.id_socio}
                  >
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</Layout>

<script>
  const botonesEliminar = document.querySelectorAll(".btn-eliminar");
  botonesEliminar.forEach((boton) => {
    boton.addEventListener("click", async () => {
      const id = boton.getAttribute("data-id");
      if (confirm("¬øSeguro que quer√©s eliminar este socio?")) {
        await fetch(`/api/socios/${id}`, { method: "DELETE" });
        location.reload();
      }
    });
  });
</script>
