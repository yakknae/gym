---
// src/pages/socios/crear.astro
import Layout from "../../layouts/Layout.astro";
import { db } from "../../lib/db";

const planes = await db.planes.findMany();
---

<Layout title="Crear Plan">
  <div class="max-w-4xl mx-auto">
    <!-- Header de la sección -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-1">
        <a
          href="/planes"
          class="text-gray-500 hover:text-orange-400 transition-colors text-sm flex items-center gap-1.5"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          planes
        </a>
        <span class="text-gray-600">/</span>
        <span class="text-gray-400 text-sm">Nuevo plan</span>
      </div>
      <h1 class="text-3xl font-bold text-white">Crear Plan</h1>
      <p class="text-gray-400 mt-1">Completá los datos del nuevo plan</p>
    </div>

    <!-- Formulario -->
    <form id="form-crear" class="space-y-6">
      <!-- Sección: Datos del plan -->
      <div class="bg-[#1a1a1a] border border-white/5 rounded-2xl p-6">
        <h2 class="text-sm font-semibold text-orange-400 uppercase tracking-widest mb-5">Datos del plan</h2>

        <div class="grid grid-cols-2 gap-4">
          <!-- Nombre -->
          <div class="flex flex-col gap-1.5">
            <label class="text-sm text-gray-400 font-medium">Nombre <span class="text-orange-500">*</span></label>
            <input
              type="text"
              name="nombre_plan"
              required
              placeholder="Ej: deluxe"
              class="bg-[#0f0f0f] border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-orange-500/50 focus:ring-1 focus:ring-orange-500/20 transition-all text-sm"
            />
          </div>

          <!-- dias -->
          <div class="flex flex-col gap-1.5">
            <label class="text-sm text-gray-400 font-medium">dias <span class="text-orange-500">*</span></label>
            <input
              type="number"
              name="dias"
              required
              placeholder="Ej: 1 - 3 - libre"
              class="bg-[#0f0f0f] border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-orange-500/50 focus:ring-1 focus:ring-orange-500/20 transition-all text-sm"
            />
          </div>

          <!-- descripcion -->
          <div class="flex flex-col gap-1.5">
            <label class="text-sm text-gray-400 font-medium">Descripcion</label>
            <input
              type="text"
              name="descripcion"
              placeholder="Ej: plan para..."
              class="bg-[#0f0f0f] border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-orange-500/50 focus:ring-1 focus:ring-orange-500/20 transition-all text-sm"
            />
          </div>

          <!-- precio -->
          <div class="flex flex-col gap-1.5">
            <label class="text-sm text-gray-400 font-medium">Precio<span class="text-orange-500">*</span></label>
            <input
              type="number"
              name="precio"
              placeholder="Ej: 150.000"
              class="bg-[#0f0f0f] border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-orange-500/50 focus:ring-1 focus:ring-orange-500/20 transition-all text-sm"
            />
          </div>
        </div>
      </div>
      <!-- Botones -->
      <div class="flex justify-end gap-3 pb-4">
        <a
          href="/planes"
          class="px-6 py-3 rounded-xl border border-white/10 text-gray-400 hover:text-white hover:border-white/20 transition-all text-sm font-medium"
        >
          Cancelar
        </a>
        <button
          type="submit"
          class="px-8 py-3 bg-orange-500 hover:bg-orange-400 text-white rounded-xl font-semibold text-sm transition-all shadow-lg shadow-orange-500/20 hover:shadow-orange-500/30 active:scale-95"
        >
          + Crear Plan
        </button>
      </div>
    </form>
  </div>

  <style>
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
    }
  </style>
  <script>
    const form = document.getElementById("form-crear") as HTMLFormElement;

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      const res = await fetch("/api/planes", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      if (res.ok) {
        window.location.href = "/planes";
      } else {
        const err = await res.json();
        alert(err.error || "Error al crear el plan");
      }
    });
  </script>
</Layout>
