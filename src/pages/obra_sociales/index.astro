---
import Layout from "../../../src/layouts/Layout.astro";
import { obraSocialService } from "../../../src/services/obraSocialService";

const obra_sociales = await obraSocialService.getAll();
---

<Layout title="Listado de obra sociales">
  <div class="flex justify-end items-center mb-6">
    <a
      href="/obra_sociales/create"
      class="bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-3 px-6 rounded-lg transition-all shadow-lg shadow-orange-500/50 flex items-center gap-2"
    >
      <span class="text-xl">+</span> Nueva obra social
    </a>
  </div>

  <div class="bg-[#1a1a1a] rounded-xl shadow-xl border border-orange-500/30 overflow-hidden">
    <table class="w-full text-left border-collapse">
      <thead class="bg-[#0f0f0f] border-b border-orange-500/30">
        <tr>
          <th class="px-6 py-4 text-sm font-semibold text-orange-500 tracking-wider text-center"
            >Nombre del Plan Social</th
          >
          <th class="px-6 py-4 text-sm font-semibold text-orange-500 tracking-wider text-center">Categoria</th>
          <th class="px-6 py-4 text-sm font-semibold text-orange-500 tracking-wider text-center">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-orange-500/10">
        {
          obra_sociales.map((obra_sociales) => (
            <tr class="hover:bg-orange-500/5 transition-colors">
              <td class="px-6 py-4 text-center ">
                <span>{obra_sociales.nombre_plan_social}</span>
              </td>
              <td class="px-6 py-4 text-sm text-white text-center">
                <span>{obra_sociales.categoria}</span>
              </td>
              <td class="px-6 py-4 text-center">
                <div class="flex justify-center gap-2">
                  <a
                    href={`/obra_sociales/${obra_sociales.id_plan_social}`}
                    class="p-2 hover:bg-orange-500/20 rounded-md transition-colors border border-transparent hover:border-orange-500/50"
                    title="Ver ficha"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="icon icon-tabler icons-tabler-outline icon-tabler-user-edit"
                    >
                      <>
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                        <path d="M6 21v-2a4 4 0 0 1 4 -4h3.5" />
                        <path d="M18.42 15.61a2.1 2.1 0 0 1 2.97 2.97l-3.39 3.42h-3v-3l3.42 -3.39" />
                      </>
                    </svg>
                  </a>
                  <button
                    class="p-2 hover:bg-red-500/20 text-red-400 rounded-md transition-colors border border-transparent hover:border-red-500/50 btn-eliminar"
                    data-id={obra_sociales.id_plan_social}
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="icon icon-tabler icons-tabler-outline icon-tabler-square-x"
                    >
                      <>
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14" />
                        <path d="M9 9l6 6m0 -6l-6 6" />
                      </>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</Layout>

<script>
  const botonesEliminar = document.querySelectorAll(".btn-eliminar");
  botonesEliminar.forEach((boton) => {
    boton.addEventListener("click", async () => {
      const id = boton.getAttribute("data-id");
      if (confirm("¿Seguro que querés eliminar esta obra social?")) {
        await fetch(`/api/obra_sociales/${id}`, { method: "DELETE" });
        location.reload();
      }
    });
  });
</script>
